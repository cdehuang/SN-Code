Since there is a lot of modified versions of code necessary for the simulation, I'm putting them all here so they can be grouped neatly. 
